[{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Description":"Create a new Sentinel Policy in Terraform Cloud","Label":"Create a Policy Set","Name":"CreatePolicySet","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"CustomDataTypeProperties":{"CatalogMoid":"shared","ObjectType":"workflow.CustomDataProperty"},"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The API call can be made to Intersight or an external endpoint added as Target. Target should be in claimed or connected state. Please refer Supported Endpoints section in the Web API request end user documentation for the list of Intersight Targets on which Web API task can be invoked. An empty value for this input indicates that the API call is made to Intersight.\n","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"External Target","Name":"Target","ObjectType":"workflow.TargetDataType","Properties":[{"DisplayAttributes":["Name","TargetType"],"ObjectType":"workflow.TargetProperty","Selector":"/api/v1/asset/Targets?$filter=(TargetType eq TerraformCloud and Status eq Connected)","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"SupportedObjects":["asset.Target"]}],"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The organization to create the policy set in. The organization must already exist in the system, and the token authenticating the API request must have permission to manage policies","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Organization","Name":"organization","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The name of the policy set. an include letters, numbers, -, and _.","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Policy Name","Name":"policyName","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"VCS repository information. When present, the policies and configuration will be sourced from the specified VCS repository instead of being defined within Terraform Cloud.","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"VCS Repo","Name":"vcsRepo","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"Whether or not this policies in this set should be checked on all of the organization's workspaces, or only on workspaces the policy set is attached to.","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Make global policy","Name":"globalPolicy","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"boolean"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The branch of the VCS repo. If empty, the VCS provider's default branch value will be used.","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"VCS Branch","Name":"branch","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The OAuth Token ID to use to connect to the VCS host.","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"VCS OAuth Token","Name":"oAuthToken","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"A description of the set's purpose. This field supports Markdown and will be rendered in the Terraform Cloud UI.","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Description","Name":"description","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The subdirectory of the attached VCS repository that contains the policies for this policy set. Files and directories outside of this sub-path will be ignored, and changes to those unrelated files won't cause the policy set to be updated. This option may only be specified when a VCS repo is present.","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Policy Path","Name":"policyPath","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}}],"ObjectType":"workflow.Properties","OutputDefinition":[{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The ID of the newly created policy","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Policy ID","Name":"policyID","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The URL of the newly created Policy","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Policy URL Link","Name":"policyURL","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}}],"RetryCount":3,"RetryDelay":60,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":600,"TimeoutPolicy":"Timeout"},"RollbackTasks":[],"SharedScope":"user","Tags":[{"Key":"category","Value":"Terraform Cloud"}],"Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"Batch":[{"Body":"{\n  \"data\": {\n    \"type\": \"policy-sets\",\n    \"attributes\": {\n      \"name\": \"{{.global.task.input.policyName}}\",\n      \"description\": \"{{.global.task.input.description}}\",\n      \"global\": \"{{.global.task.input.globalPolicy}}\",\n      \"policies-path\": \"{{.global.task.input.policyPath}}\",\n      \"vcs-repo\": {\n        \"branch\": \"{{.global.task.input.branch}}\",\n        \"identifier\": \"{{.global.task.input.vcsRepo}}\",\n        \"ingress-submodules\": false,\n        \"oauth-token-id\": \"{{.global.task.input.oAuthToken}}\"\n      }\n    },\n    \"relationships\": {\n    }\n  }\n}","ContentType":"json","Description":"Create a new Policy Set in Terraform Cloud","EndpointRequestType":"Internal","Headers":{"Content-Type":["application/vnd.api+json"]},"Label":"Create new Policy Set","Method":"POST","Name":"InvokeGenericWebApi1","ObjectType":"workflow.WebApi","Outcomes":[{"Condition":"{{eq .global.InvokeGenericWebApi1.output.HttpStatusCode 201}}","Message":"Successfully created a policy set","Name":"201","Type":"Success"},{"Condition":"{{eq .global.InvokeGenericWebApi1.output.HttpStatusCode 404}}","Message":"Organization not found, or user unauthorized to perform action","Name":"404","Type":"TerminalError"},{"Condition":"{{eq .global.InvokeGenericWebApi1.output.HttpStatusCode 422}}","Message":"Malformed request body (missing attributes, wrong types, etc.)","Name":"422","Type":"TerminalError"},{"Condition":"{{gt .global.InvokeGenericWebApi1.output.HttpStatusCode 300}}","Message":"Generic failure {{.global.InvokeGenericWebApi1.output.HttpStatusMsg}}","Name":"Generic Faliure","Type":"TerminalError"}],"ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"policyID","ObjectType":"content.Parameter","Path":"$.data.id","Secure":false,"Type":"string"},{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"policyLink","ObjectType":"content.Parameter","Path":"$.data.links.self","Secure":false,"Type":"string"}],"Types":[]},"TargetType":"Endpoint","Url":"/api/v2/organizations/{{.global.task.input.organization}}/policy-sets"}],"ClassId":"workflow.BatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Description":"Create a new Sentinel Policy in Terraform Cloud","Name":"Create a Policy Set","ObjectType":"workflow.BatchApiExecutor","Output":{"policyID":"{{.global.InvokeGenericWebApi1.output.policyID}}","policyURL":"{{.global.InvokeGenericWebApi1.output.policyLink}}"},"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"CreatePolicySet\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/BatchApiExecutors","Verb":"POST"}]